{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vnetname": {
            "type": "String"
        },
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "CreatedAt":{
            "type":"string",
            "defaultValue": "[utcNow('d')]"
        },
        "project":{
            "type":"string",
            "defaultValue":""
        },
        "virtualNetworkPrefix":{
            "type": "string",
            "defaultValue": "10.0.0.0/22"
        },
        "subnet1Prefix":{
            "type":"string",
            "defaultValue":"10.0.1.0/24"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Network/virtualNetworks",
            "apiVersion": "2022-07-01",
            "name": "[parameters('vnetname')]",
            "location": "[parameters('location')]",
            "tags": {
                "project": "[parameters('project')]",
                "createdAt": "[parameters('CreatedAt')]"
            },
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "[parameters('virtualNetworkPrefix')]"
                    ]
                },
                "subnets": [
                    {
                        "name": "appservice",
                        "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('vnetname'), 'appservice')]",
                        "properties": {
                            "addressPrefix": "[parameters('subnet1Prefix')]",
                            "serviceEndpoints": [
                                {
                                    "service": "Microsoft.Storage",
                                    "locations": [
                                        "[parameters('location')]",
                                        "centralus"
                                    ]
                                },
                                {
                                    "service": "Microsoft.Sql",
                                    "locations": [
                                        "[parameters('location')]"
                                    ]
                                }
                            ],
                            "delegations": [
                                {
                                    "name": "delegation",
                                    "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('vnetname'), 'appservice'), '/delegations/delegation')]",
                                    "properties": {
                                        "serviceName": "Microsoft.Web/serverfarms"
                                    },
                                    "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                                }
                            ],
                            "privateEndpointNetworkPolicies": "Disabled",
                            "privateLinkServiceNetworkPolicies": "Enabled"
                        },
                        "type": "Microsoft.Network/virtualNetworks/subnets"
                    }
                ],
                "virtualNetworkPeerings": [],
                "enableDdosProtection": false
            }
        },
        {
            "type": "Microsoft.Network/virtualNetworks/subnets",
            "apiVersion": "2022-07-01",
            "name": "[concat(parameters('vnetname'), '/appservice')]",
            "dependsOn": [
                "[resourceId('Microsoft.Network/virtualNetworks', parameters('vnetname'))]"
            ],
            "properties": {
                "addressPrefix": "[parameters('subnet1Prefix')]",
                "serviceEndpoints": [
                    {
                        "service": "Microsoft.Storage",
                        "locations": [
                            "[parameters('location')]",
                            "centralus"
                        ]
                    },
                    {
                        "service": "Microsoft.Sql",
                        "locations": [
                            "[parameters('location')]"
                        ]
                    }
                ],
                "delegations": [
                    {
                        "name": "delegation",
                        "id": "[concat(resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('vnetname'), 'appservice'), '/delegations/delegation')]",
                        "properties": {
                            "serviceName": "Microsoft.Web/serverfarms"
                        },
                        "type": "Microsoft.Network/virtualNetworks/subnets/delegations"
                    }
                ],
                "privateEndpointNetworkPolicies": "Disabled",
                "privateLinkServiceNetworkPolicies": "Enabled"
            }
        }
    ]
}